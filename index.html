<!DOCTYPE html>
<html lang="de">
<link rel="stylesheet" href="style.css">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV-Programm - Deutsche Sender</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📺 TV-Programm</h1>
            <div class="current-time" id="currentTime"></div>
            <button class="refresh-btn" onclick="loadTVProgram()">🔄 Aktualisieren</button>
        </div>
        
        <div class="controls">
            <!-- Suchleiste -->
            <div class="search-section">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput" 
                    placeholder="🔍 Sender durchsuchen und auswählen..."
                    oninput="searchAndSelectChannels()"
                    autocomplete="off"
                >
                <div id="searchResults" class="search-results"></div>
            </div>
        </div>
        
        <div id="loading" class="loading">
            Lade TV-Programmdaten...
        </div>
        
        <!-- Tabellen Container -->
        <div class="tables-container" id="tablesContainer" style="display: none;">
            <!-- Jetzt laufende Programme -->
            <div class="table-section">
                <div class="table-title now">🔴 Läuft jetzt</div>
                <div id="nowTable">
                    <!-- Wird dynamisch gefüllt -->
                </div>
            </div>
            
            <!-- 20:15 Programme -->
            <div class="table-section">
                <div class="table-title primetime">⭐ Um 20:15 Uhr</div>
                <div id="primetimeTable">
                    <!-- Wird dynamisch gefüllt -->
                </div>
            </div>
        </div>
    </div>

    <script src="germanChannels.js"></script>
    <script src="main.js"></script>
    <script>
    let selectedChannels = new Set();

    function searchAndSelectChannels() {
        const input = document.getElementById('searchInput');
        const resultsDiv = document.getElementById('searchResults');
        const query = input.value.trim().toLowerCase();
        resultsDiv.innerHTML = '';
        if (!query) {
            // Show selected channels as tags
            if (selectedChannels.size > 0) {
                resultsDiv.innerHTML = Array.from(selectedChannels).map(id => {
                    const ch = germanChannels.find(c => c.id === id);
                    return `<span class="selected-channel-tag">${ch ? ch.name : id} <button onclick="removeSelectedChannel('${id}')">×</button></span>`;
                }).join(' ');
            }
            return;
        }
        // Filter channels
        const filtered = germanChannels.filter(ch => ch.name.toLowerCase().includes(query));
        if (filtered.length === 0) {
            resultsDiv.innerHTML = '<div class="no-results">Kein Sender gefunden</div>';
            return;
        }
        resultsDiv.innerHTML = filtered.map(ch => {
            const checked = selectedChannels.has(ch.id) ? 'checked' : '';
            return `<label class="search-result-item"><input type="checkbox" value="${ch.id}" ${checked} onchange="toggleChannelSearch('${ch.id}')"> ${ch.name}</label>`;
        }).join('');
    }

    function toggleChannelSearch(id) {
        if (selectedChannels.has(id)) {
            selectedChannels.delete(id);
        } else {
            selectedChannels.add(id);
        }
        updateTables();
        searchAndSelectChannels();
    }

    function removeSelectedChannel(id) {
        selectedChannels.delete(id);
        updateTables();
        searchAndSelectChannels();
    }

    window.addEventListener('DOMContentLoaded', () => {
        searchAndSelectChannels();
    });
    </script>
</body>
</html>